# 多Sheet数据合并工具 - 完整使用指南

## 🎯 项目概述

这套工具专门用于将多个文件夹内的Excel和CSV数据表合并成一个Excel文件，**每个原始文件作为独立的Sheet保存**，而不是将所有数据混合到一个Sheet中。

## 📁 工具文件说明

| 文件名 | 功能描述 | 适用场景 |
|--------|----------|----------|
| `multi_sheet_merger.py` | 完整功能的多Sheet合并器 | 需要详细控制和高级功能 |
| `easy_multi_sheet_merger.py` | 简化版多Sheet合并器 | 日常使用，配置简单 |
| `data_merger.py` | 单Sheet合并器（旧版） | 将所有数据合并到一个Sheet |
| `finance_data_merger.py` | 金融数据分析合并器 | 带智能分析功能的合并 |

## 🚀 快速开始

### 方法1：使用简易版本（推荐）

1. **编辑配置**：打开 `easy_multi_sheet_merger.py`，修改以下配置：

```python
INPUT_FOLDERS = [
    "/您的路径/数据文件夹1",
    "/您的路径/数据文件夹2",
    "./相对路径/数据文件夹",
]

OUTPUT_FILE = f"我的合并数据_{datetime.now().strftime('%Y%m%d_%H%M')}.xlsx"
```

2. **运行脚本**：
```bash
python3 easy_multi_sheet_merger.py
```

3. **查看结果**：用Excel打开生成的文件，每个原始文件都是独立的Sheet

### 方法2：使用完整版本

```bash
python3 multi_sheet_merger.py
```

## 📊 输出结果

合并后的Excel文件包含：

- **独立Sheet**: 每个原始数据文件保存为一个Sheet
- **Sheet命名**: 基于原始文件名，自动处理重复和无效字符
- **汇总信息**: 专门的"📊汇总信息"Sheet包含：
  - 处理统计信息
  - 文件夹分布
  - 详细文件清单
  - 处理失败的文件列表

## 🔧 配置选项详解

### 基础配置

```python
# 输入文件夹路径
INPUT_FOLDERS = [
    "/绝对路径/文件夹1",
    "./相对路径/文件夹2",
]

# 输出文件名
OUTPUT_FILE = "合并结果.xlsx"

# 支持的文件格式
SUPPORTED_FORMATS = ['.xlsx', '.csv', '.xls']
```

### 高级配置

```python
MAX_SHEETS = 200                # 最大Sheet数量限制
INCLUDE_SUMMARY = True          # 是否生成汇总Sheet
INCLUDE_FILE_INFO = True        # 是否在每个Sheet添加文件信息
```

## 📋 实际使用示例

### 示例1: 合并财务数据

```python
INPUT_FOLDERS = [
    "./2024年Q1财务数据",
    "./2024年Q2财务数据", 
    "./2024年Q3财务数据",
    "./2024年Q4财务数据",
]
OUTPUT_FILE = "2024年度财务数据汇总.xlsx"
```

### 示例2: 合并不同部门数据

```python
INPUT_FOLDERS = [
    "/公司数据/销售部",
    "/公司数据/市场部",
    "/公司数据/财务部",
    "/公司数据/人事部",
]
OUTPUT_FILE = "公司各部门数据汇总.xlsx"
```

### 示例3: 合并项目数据

```python
INPUT_FOLDERS = [
    "./项目A/数据文件",
    "./项目B/数据文件",
    "./项目C/数据文件",
]
OUTPUT_FILE = "多项目数据汇总.xlsx"
```

## 🎯 核心特性

### ✅ 支持的功能

- **多格式支持**: Excel (.xlsx, .xls), CSV (.csv)
- **递归搜索**: 自动搜索子文件夹中的数据文件
- **编码智能检测**: 自动处理CSV文件的编码问题
- **Sheet名称管理**: 自动清理无效字符，处理重复名称
- **错误处理**: 完善的错误报告和继续处理机制
- **进度显示**: 实时显示处理进度
- **汇总报告**: 自动生成详细的处理统计

### 🔍 数据完整性

- **原始数据保持不变**: 每个文件的数据结构完全保留
- **文件来源追踪**: 每个Sheet包含原始文件信息
- **处理时间记录**: 记录数据处理的具体时间
- **统计信息**: 详细的行数、列数统计

## ⚠️ 注意事项

### Excel限制

- **最大Sheet数**: Excel限制为255个Sheet
- **Sheet名称长度**: 最大31个字符
- **文件大小**: 建议控制在几百MB以内

### 性能考虑

- **大量文件**: 超过100个文件时处理时间较长
- **大文件**: 单个文件超过几万行时需要更多内存
- **网络路径**: 建议复制到本地后再处理

### 数据质量

- **文件格式一致性**: 确保同类数据格式相近
- **文件完整性**: 检查源文件是否损坏
- **权限问题**: 确保对所有文件夹有读取权限

## 🔧 故障排除

### 常见问题

1. **文件夹路径错误**
   ```
   ❌ /某个路径 (文件夹不存在)
   ```
   **解决**: 检查路径是否正确，使用绝对路径

2. **编码问题**
   ```
   ❌ 失败: 'utf-8' codec can't decode
   ```
   **解决**: 脚本会自动尝试多种编码，一般可以自动解决

3. **内存不足**
   ```
   ❌ MemoryError
   ```
   **解决**: 减少MAX_SHEETS数量，分批处理

4. **Sheet名称冲突**
   ```
   自动处理，会在重复名称后添加序号
   ```

### 性能优化建议

1. **分批处理**: 对于超大量文件，建议分文件夹分批处理
2. **本地处理**: 将网络文件复制到本地再处理
3. **格式统一**: 尽量使用相同格式的文件（都用Excel或都用CSV）

## 📈 高级用法

### 自定义Sheet处理

如需要特殊的Sheet处理逻辑，可以修改脚本中的 `merge_to_multiple_sheets` 函数。

### 批量处理脚本

```python
# 批量处理多个项目
projects = ['项目A', '项目B', '项目C']
for project in projects:
    INPUT_FOLDERS = [f"./{project}/数据"]
    OUTPUT_FILE = f"{project}_数据汇总.xlsx"
    # 运行合并逻辑
```

### 定时任务

可以将脚本设置为定时任务，自动合并新增的数据文件。

## 🎉 总结

这套多Sheet合并工具完美解决了将多个数据文件整合到一个Excel文件中，同时保持每个文件数据独立性的需求。特别适合：

- **财务数据整合**: 将各期财务报表整合到一个文件
- **部门数据汇总**: 将各部门数据集中管理
- **项目数据归档**: 将项目相关数据统一存档
- **数据分发**: 将分散的数据文件整合后分发给相关人员

通过使用这些工具，您可以高效地管理和组织大量的数据文件，提高工作效率。 